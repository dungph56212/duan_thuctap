<?php
// bulk_add_books.php - Th√™m nhi·ªÅu s√°ch c√πng l√∫c
session_start();
require_once 'commons/env.php';
require_once 'commons/function.php';

if (isset($_POST['bulk_add'])) {
    try {
        $conn = connectDB();
        
        // Danh s√°ch s√°ch m·∫´u ƒë·ªÉ th√™m v√†o
        $sampleBooks = [
            [
                'ten_san_pham' => 'ƒê·∫Øc Nh√¢n T√¢m',
                'gia_san_pham' => 89000,
                'gia_khuyen_mai' => 69000,
                'hinh_anh' => 'dac-nhan-tam.jpg',
                'so_luong' => 50,
                'mo_ta' => 'Cu·ªën s√°ch kinh ƒëi·ªÉn v·ªÅ ngh·ªá thu·∫≠t giao ti·∫øp v√† ·ª©ng x·ª≠ c·ªßa Dale Carnegie.',
                'danh_muc_id' => 1,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'Nh√† Gi·∫£ Kim',
                'gia_san_pham' => 79000,
                'gia_khuyen_mai' => 59000,
                'hinh_anh' => 'nha-gia-kim.jpg',
                'so_luong' => 30,
                'mo_ta' => 'Ti·ªÉu thuy·∫øt n·ªïi ti·∫øng c·ªßa Paulo Coelho v·ªÅ h√†nh tr√¨nh t√¨m ki·∫øm kho b√°u.',
                'danh_muc_id' => 1,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'T√¥i Th·∫•y Hoa V√†ng Tr√™n C·ªè Xanh',
                'gia_san_pham' => 65000,
                'gia_khuyen_mai' => 45000,
                'hinh_anh' => 'hoa-vang-co-xanh.jpg',
                'so_luong' => 40,
                'mo_ta' => 'Ti·ªÉu thuy·∫øt c·ªßa Nguy·ªÖn Nh·∫≠t √Ånh v·ªÅ tu·ªïi th∆° d·ªØ d·ªôi.',
                'danh_muc_id' => 1,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'S√°ch Gi√°o Khoa To√°n L·ªõp 12',
                'gia_san_pham' => 45000,
                'gia_khuyen_mai' => null,
                'hinh_anh' => 'sgk-toan-12.jpg',
                'so_luong' => 100,
                'mo_ta' => 'S√°ch gi√°o khoa To√°n l·ªõp 12 theo ch∆∞∆°ng tr√¨nh m·ªõi.',
                'danh_muc_id' => 2,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'S√°ch Gi√°o Khoa VƒÉn L·ªõp 11',
                'gia_san_pham' => 42000,
                'gia_khuyen_mai' => null,
                'hinh_anh' => 'sgk-van-11.jpg',
                'so_luong' => 80,
                'mo_ta' => 'S√°ch gi√°o khoa Ng·ªØ vƒÉn l·ªõp 11 theo ch∆∞∆°ng tr√¨nh m·ªõi.',
                'danh_muc_id' => 2,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'One Piece - T·∫≠p 1',
                'gia_san_pham' => 25000,
                'gia_khuyen_mai' => 22000,
                'hinh_anh' => 'one-piece-tap-1.jpg',
                'so_luong' => 200,
                'mo_ta' => 'Manga n·ªïi ti·∫øng c·ªßa Eiichiro Oda v·ªÅ bƒÉng h·∫£i t·∫∑c M≈© R∆°m.',
                'danh_muc_id' => 3,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'Doraemon - T·∫≠p 1',
                'gia_san_pham' => 20000,
                'gia_khuyen_mai' => 18000,
                'hinh_anh' => 'doraemon-tap-1.jpg',
                'so_luong' => 150,
                'mo_ta' => 'Truy·ªán tranh thi·∫øu nhi n·ªïi ti·∫øng v·ªÅ ch√∫ m√®o m√°y Doraemon.',
                'danh_muc_id' => 3,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'Sherlock Holmes - Cu·ªôc Phi√™u L∆∞u',
                'gia_san_pham' => 95000,
                'gia_khuyen_mai' => 75000,
                'hinh_anh' => 'sherlock-holmes.jpg',
                'so_luong' => 25,
                'mo_ta' => 'Tuy·ªÉn t·∫≠p truy·ªán trinh th√°m kinh ƒëi·ªÉn c·ªßa Arthur Conan Doyle.',
                'danh_muc_id' => 1,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'L·∫≠p Tr√¨nh Web v·ªõi PHP & MySQL',
                'gia_san_pham' => 299000,
                'gia_khuyen_mai' => 249000,
                'hinh_anh' => 'lap-trinh-php.jpg',
                'so_luong' => 15,
                'mo_ta' => 'S√°ch h∆∞·ªõng d·∫´n l·∫≠p tr√¨nh web t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao.',
                'danh_muc_id' => 4,
                'trang_thai' => 1
            ],
            [
                'ten_san_pham' => 'H·ªçc JavaScript Hi·ªáu Qu·∫£',
                'gia_san_pham' => 259000,
                'gia_khuyen_mai' => 199000,
                'hinh_anh' => 'hoc-javascript.jpg',
                'so_luong' => 20,
                'mo_ta' => 'S√°ch h·ªçc JavaScript t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao v·ªõi nhi·ªÅu v√≠ d·ª• th·ª±c t·∫ø.',
                'danh_muc_id' => 4,
                'trang_thai' => 1
            ]
        ];
        
        $sql = "INSERT INTO san_phams (
            ten_san_pham, gia_san_pham, gia_khuyen_mai, hinh_anh, 
            so_luong, luot_xem, ngay_nhap, mo_ta, danh_muc_id, trang_thai
        ) VALUES (
            :ten_san_pham, :gia_san_pham, :gia_khuyen_mai, :hinh_anh,
            :so_luong, 0, NOW(), :mo_ta, :danh_muc_id, :trang_thai
        )";
        
        $stmt = $conn->prepare($sql);
        $added = 0;
        $errors = [];
        
        foreach ($sampleBooks as $book) {
            try {
                $stmt->execute([
                    ':ten_san_pham' => $book['ten_san_pham'],
                    ':gia_san_pham' => $book['gia_san_pham'],
                    ':gia_khuyen_mai' => $book['gia_khuyen_mai'],
                    ':hinh_anh' => $book['hinh_anh'],
                    ':so_luong' => $book['so_luong'],
                    ':mo_ta' => $book['mo_ta'],
                    ':danh_muc_id' => $book['danh_muc_id'],
                    ':trang_thai' => $book['trang_thai']
                ]);
                $added++;
            } catch (Exception $e) {
                $errors[] = "L·ªói th√™m '{$book['ten_san_pham']}': " . $e->getMessage();
            }
        }
        
        $success = "‚úÖ ƒê√£ th√™m $added s√°ch th√†nh c√¥ng!";
        if (!empty($errors)) {
            $success .= "<br>‚ö†Ô∏è M·ªôt s·ªë l·ªói: " . implode('<br>', array_slice($errors, 0, 3));
        }
        
    } catch (Exception $e) {
        $error = "‚ùå L·ªói: " . $e->getMessage();
    }
}

// L·∫•y th·ªëng k√™
try {
    $conn = connectDB();
    $stmt = $conn->query("SELECT COUNT(*) FROM san_phams");
    $totalBooks = $stmt->fetchColumn();
    
    $stmt = $conn->query("SELECT COUNT(*) FROM danh_mucs");
    $totalCategories = $stmt->fetchColumn();
    
    $stmt = $conn->query("SELECT SUM(so_luong) FROM san_phams");
    $totalQuantity = $stmt->fetchColumn();
    
} catch (Exception $e) {
    $totalBooks = 0;
    $totalCategories = 0;
    $totalQuantity = 0;
}
?>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Th√™m S√°ch H√†ng Lo·∫°t</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #0984e3;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .content {
            padding: 40px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .sample-books {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .sample-books h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .book-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .book-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .book-title {
            font-weight: 600;
            color: #0984e3;
            margin-bottom: 5px;
        }
        
        .book-price {
            color: #e74c3c;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .book-desc {
            color: #666;
            font-size: 0.9em;
        }
        
        .btn {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 118, 117, 0.4);
        }
        
        .navigation {
            padding: 20px;
            background: #f8f9fa;
            text-align: center;
        }
        
        .navigation a {
            color: #0984e3;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .navigation a:hover {
            background: #0984e3;
            color: white;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .stats {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Th√™m S√°ch H√†ng Lo·∫°t</h1>
            <p>Th√™m nhi·ªÅu s√°ch m·∫´u v√†o database c√πng m·ªôt l√∫c</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number"><?= number_format($totalBooks) ?></div>
                <div class="stat-label">üìö T·ªïng s·ªë s√°ch</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><?= number_format($totalCategories) ?></div>
                <div class="stat-label">üìÅ Danh m·ª•c</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><?= number_format($totalQuantity) ?></div>
                <div class="stat-label">üì¶ T·ªïng s·ªë l∆∞·ª£ng</div>
            </div>
        </div>
        
        <div class="content">
            <?php if (isset($success)): ?>
                <div class="alert alert-success"><?= $success ?></div>
            <?php endif; ?>
            
            <?php if (isset($error)): ?>
                <div class="alert alert-error"><?= $error ?></div>
            <?php endif; ?>
            
            <div class="warning">
                ‚ö†Ô∏è <strong>L∆∞u √Ω:</strong> Ch·ª©c nƒÉng n√†y s·∫Ω th√™m 10 cu·ªën s√°ch m·∫´u v√†o database. 
                H√£y ƒë·∫£m b·∫£o b·∫°n ƒë√£ t·∫°o c√°c danh m·ª•c v·ªõi ID 1, 2, 3, 4 tr∆∞·ªõc khi ch·∫°y.
            </div>
            
            <div class="sample-books">
                <h3>üìñ Danh s√°ch s√°ch s·∫Ω ƒë∆∞·ª£c th√™m:</h3>
                <div class="book-list">
                    <div class="book-item">
                        <div class="book-title">üìö ƒê·∫Øc Nh√¢n T√¢m</div>
                        <div class="book-price">üí∞ 89,000ƒë ‚Üí 69,000ƒë</div>
                        <div class="book-desc">Cu·ªën s√°ch kinh ƒëi·ªÉn v·ªÅ giao ti·∫øp</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üåü Nh√† Gi·∫£ Kim</div>
                        <div class="book-price">üí∞ 79,000ƒë ‚Üí 59,000ƒë</div>
                        <div class="book-desc">Ti·ªÉu thuy·∫øt n·ªïi ti·∫øng c·ªßa Paulo Coelho</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üå± T√¥i Th·∫•y Hoa V√†ng Tr√™n C·ªè Xanh</div>
                        <div class="book-price">üí∞ 65,000ƒë ‚Üí 45,000ƒë</div>
                        <div class="book-desc">Ti·ªÉu thuy·∫øt c·ªßa Nguy·ªÖn Nh·∫≠t √Ånh</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üìñ S√°ch Gi√°o Khoa To√°n 12</div>
                        <div class="book-price">üí∞ 45,000ƒë</div>
                        <div class="book-desc">SGK theo ch∆∞∆°ng tr√¨nh m·ªõi</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üìù S√°ch Gi√°o Khoa VƒÉn 11</div>
                        <div class="book-price">üí∞ 42,000ƒë</div>
                        <div class="book-desc">SGK Ng·ªØ vƒÉn l·ªõp 11</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üè¥‚Äç‚ò†Ô∏è One Piece - T·∫≠p 1</div>
                        <div class="book-price">üí∞ 25,000ƒë ‚Üí 22,000ƒë</div>
                        <div class="book-desc">Manga n·ªïi ti·∫øng v·ªÅ h·∫£i t·∫∑c</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">ü§ñ Doraemon - T·∫≠p 1</div>
                        <div class="book-price">üí∞ 20,000ƒë ‚Üí 18,000ƒë</div>
                        <div class="book-desc">Truy·ªán tranh thi·∫øu nhi</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üîç Sherlock Holmes</div>
                        <div class="book-price">üí∞ 95,000ƒë ‚Üí 75,000ƒë</div>
                        <div class="book-desc">Truy·ªán trinh th√°m kinh ƒëi·ªÉn</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">üíª L·∫≠p Tr√¨nh Web PHP</div>
                        <div class="book-price">üí∞ 299,000ƒë ‚Üí 249,000ƒë</div>
                        <div class="book-desc">S√°ch l·∫≠p tr√¨nh t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao</div>
                    </div>
                    <div class="book-item">
                        <div class="book-title">‚ö° H·ªçc JavaScript Hi·ªáu Qu·∫£</div>
                        <div class="book-price">üí∞ 259,000ƒë ‚Üí 199,000ƒë</div>
                        <div class="book-desc">JavaScript v·ªõi nhi·ªÅu v√≠ d·ª• th·ª±c t·∫ø</div>
                    </div>
                </div>
            </div>
            
            <form method="POST" action="">
                <button type="submit" name="bulk_add" class="btn" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën th√™m 10 s√°ch n√†y v√†o database?')">
                    ‚ú® Th√™m T·∫•t C·∫£ S√°ch V√†o Database
                </button>
            </form>
            
            <form method="POST" action="" style="margin-top: 10px;">
                <button type="submit" name="clear_all" class="btn btn-danger" onclick="return confirm('‚ö†Ô∏è NGUY HI·ªÇM: B·∫°n c√≥ ch·∫Øc mu·ªën X√ìA T·∫§T C·∫¢ s√°ch trong database? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')">
                    üóëÔ∏è X√≥a T·∫•t C·∫£ S√°ch (Nguy hi·ªÉm!)
                </button>
            </form>
        </div>
        
        <div class="navigation">
            <a href=".">üè† Trang ch·ªß</a>
            <a href="add_books.php">‚ûï Th√™m s√°ch l·∫ª</a>
            <a href="simple_chatbot_test.php">ü§ñ Test ChatBot</a>
            <a href="check_chatbot_errors.php">üîç Check Errors</a>
        </div>
    </div>
</body>
</html>

<?php
// X·ª≠ l√Ω x√≥a t·∫•t c·∫£ s√°ch
if (isset($_POST['clear_all'])) {
    try {
        $conn = connectDB();
        $conn->exec("DELETE FROM san_phams");
        echo "<script>alert('‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ s√°ch!'); window.location.reload();</script>";
    } catch (Exception $e) {
        echo "<script>alert('‚ùå L·ªói: " . addslashes($e->getMessage()) . "');</script>";
    }
}
?>
